tasks.register('buildAll') {
    group = 'build'
    description = 'Builds all subprojects'
    dependsOn subprojects.collect { it.tasks.named('build') }
}

def registerBuildGroupTask = { String taskName, String moduleKeyword ->
    tasks.register(taskName) {
        group = 'build'
        description = "Builds all ${moduleKeyword} subprojects"

        dependsOn(subprojects
                .findAll { it.name.contains(moduleKeyword) }
                .collect { it.tasks.named('build') }
        )
    }
}

registerBuildGroupTask('buildBackend', 'backend')
registerBuildGroupTask('buildFrontend', 'frontend')

tasks.register("dockerDown", Exec) {
    group = "dev"
    commandLine "docker", "compose", "down", "--rmi", "local", "-v"
}

tasks.register("dockerUp", Exec) {
    group = "dev"
    commandLine "docker", "compose", "up", "-d", "--build"
}

tasks.register("devUp") {
    group = "dev"
    dependsOn("buildBackend", "buildFrontend", "dockerDown", "dockerUp")
}